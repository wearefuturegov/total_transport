%section.section.concessions
  %h2
    = I18n.t('bookings.passenger.title')
  
  %div.plusminus
    = form.label :number_of_adults do
      = t('bookings.passenger.adult.title')
      %span.small
        = t('bookings.passenger.adult.extra')
    = form.number_field :number_of_adults, class: 'passenger_number', 'data-target' => 'adult_tickets', readonly: true
  
  %div.plusminus
    = form.label :child_tickets do
      = t('bookings.passenger.child.title')
      %span.small
        = t('bookings.passenger.child.extra')
    = form.number_field :child_tickets, class: 'passenger_number', 'data-target' => 'child_tickets', readonly: true

  -# 
    %div.plusminus
      = form.label :older_bus_passes, I18n.t('bookings.passenger.pass')
      = form.number_field :older_bus_passes, class: 'passenger_number', 'data-target' => 'older_tickets', readonly: true
        
  = form.hidden_field :number_of_passengers
    
  %ul
    %li#adult_tickets
      %span.number
        = @booking.number_of_adults
      %span.single_price.hidden
        x adult ticket(s) @ #{number_to_currency(@booking.adult_single_price, :unit => "£")}
      %span.return_price
        x adult ticket(s) @ #{number_to_currency(@booking.adult_return_price, :unit => "£")}
    
    %li#child_tickets{class: @booking.child_tickets == 0 ? 'hidden' : ''}
      %span.number
        = @booking.child_tickets
      %span.single_price.hidden
        x child ticket(s) @ #{number_to_currency(@booking.child_single_price, :unit => "£")}
      %span.return_price
        x child ticket(s) @ #{number_to_currency(@booking.child_return_price, :unit => "£")}
      
    %li#older_tickets{class: @booking.older_bus_passes == 0 ? 'hidden' : ''}
      %span.number
        = @booking.older_bus_passes
      x bus pass ticket(s) @ #{number_to_currency(0, :unit => "£")}
    
  %p#total.strong
    Total:
    %span.single_price.hidden
      = number_to_currency(@booking.single_price, :unit => "£")
    %span.return_price
      = number_to_currency(@booking.return_price, :unit => "£")
      
- content_for :js do
  :javascript
  
    $(function() {
      $('.passenger_number').after('<div class="inc increment button">+</div><div class="dec increment button">-</div>');
    
      $('.increment').click(function() {
        var $button = $(this);
        var $input = $button.parent().find("input");
        var oldValue = $input.val();
        var newValue;

        if ($button.text() == "+") {
      	  newValue = parseFloat(oldValue) + 1;
      	} else {
          if (oldValue > 0) {
            newValue = parseFloat(oldValue) - 1;
          } else {
            newValue = 0;
          }
        }

        $input.val(newValue);
        $input.trigger('change');
      });
    
    });
  
    $('.passenger_number').change(function() {
      var number_of_passengers = $('.passenger_number').toArray().reduce(function(total, el) {
        var $el = $(el);
        var value = parseInt($el.val());
        var target = $el.data('target');
        
        $('#'+ target +' .number').html(value);
                
        if (value > 0) {
          $('#'+ target).removeClass('hidden');
        } else {
          $('#'+ target).addClass('hidden');
        }
        
        return total + value;
      }, 0);
      
      $('#booking_number_of_passengers').val(number_of_passengers);
      $('form.edit_booking').trigger("change");
    });

    $('form.edit_booking').change(function() {
      $.get(
        '#{price_api_route_booking_path(@route, @booking)}',
        $(this).serialize()
      ).done(
        function( data ) {
          $("#total .single_price").html(data.single);
          $("#total .return_price").html(data.return);
        }
      );
    });
